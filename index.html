<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pay Parking</title>
  <style>
    body {
      background-color: #121212;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #00d9ff;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 8px;
      border-radius: 5px;
      border: none;
      font-size: 15px;
    }
    input, select {
      background-color: #2a2a2a;
      color: #eee;
    }
    button {
      background-color: #00d9ff;
      color: #000;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover {
      background-color: #00aacc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #1f1f1f;
      color: #00d9ff;
    }
    tr:nth-child(even) {
      background-color: #1c1c1c;
    }
    .totals {
      margin-top: 20px;
      text-align: center;
      font-size: 18px;
    }
    .footer-controls {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Pay Parking</h1>

  <div class="controls">
    <select id="vehicleType">
      <option value="Motorcycle" data-price="50">Motorcycle - ₱50</option>
      <option value="Tricycle" data-price="75">Tricycle - ₱75</option>
      <option value="E-bike" data-price="50">E-bike - ₱50</option>
    </select>
    <input type="number" id="qty" min="1" placeholder="Qty" value="1" />
    <input type="text" id="ref" placeholder="Ref (Plate)" />
    <button id="addBtn">Add Entry</button>
    <select id="filterStatus">
      <option value="All">All</option>
      <option value="Unpaid">Unpaid</option>
      <option value="Paid">Paid</option>
      <option value="Left">Left</option>
    </select>
    <button id="importBtn">Import CSV</button>
    <button id="exportBtn">Export CSV</button>
    <input type="file" id="fileInput" accept=".csv" style="display:none" />
  </div>

  <table id="parkingTable">
    <thead>
      <tr>
        <th>Type</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Ref</th>
        <th>Total</th>
        <th>Status</th>
        <th>Time</th>
        <th>Edit</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="totals">
    <p>Total Paid: ₱<span id="paidTotal">0</span></p>
    <p>Total Left: ₱<span id="leftTotal">0</span></p>
    <p>Overall Total: ₱<span id="overallTotal">0</span></p>
  </div>

  <div class="footer-controls">
    <button id="resetBtn">Reset All</button>
  </div>

  <script>
    const vehicleType = document.getElementById("vehicleType");
    const qtyInput = document.getElementById("qty");
    const refInput = document.getElementById("ref");
    const addBtn = document.getElementById("addBtn");
    const parkingTable = document.getElementById("parkingTable").querySelector("tbody");
    const paidTotalEl = document.getElementById("paidTotal");
    const leftTotalEl = document.getElementById("leftTotal");
    const overallTotalEl = document.getElementById("overallTotal");
    const resetBtn = document.getElementById("resetBtn");
    const fileInput = document.getElementById("fileInput");
    const importBtn = document.getElementById("importBtn");
    const exportBtn = document.getElementById("exportBtn");
    const filterStatus = document.getElementById("filterStatus");

    let entries = JSON.parse(localStorage.getItem("parkingEntries") || "[]");

    function saveData() {
      localStorage.setItem("parkingEntries", JSON.stringify(entries));
      renderTable();
    }

    function renderTable() {
      parkingTable.innerHTML = "";
      let paidTotal = 0, leftTotal = 0, overallTotal = 0;
      const filter = filterStatus.value;
      entries.forEach((entry, index) => {
        if (filter !== "All" && entry.status !== filter) return;
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${entry.type}</td>
          <td>₱${entry.price}</td>
          <td>${entry.qty}</td>
          <td>${entry.ref}</td>
          <td>₱${entry.total}</td>
          <td>
            <select onchange="updateStatus(${index}, this.value)">
              <option ${entry.status === "Unpaid" ? "selected" : ""}>Unpaid</option>
              <option ${entry.status === "Paid" ? "selected" : ""}>Paid</option>
              <option ${entry.status === "Left" ? "selected" : ""}>Left</option>
            </select>
          </td>
          <td>${entry.time}</td>
          <td><button onclick="editEntry(${index})">✏️</button></td>
        `;
        parkingTable.appendChild(row);
        overallTotal += entry.total;
        if (entry.status === "Paid") paidTotal += entry.total;
        if (entry.status === "Left") leftTotal += entry.total;
      });
      paidTotalEl.textContent = paidTotal;
      leftTotalEl.textContent = leftTotal;
      overallTotalEl.textContent = overallTotal;
    }

    function addEntry() {
      const type = vehicleType.value;
      const price = parseInt(vehicleType.selectedOptions[0].dataset.price);
      const qty = parseInt(qtyInput.value);
      const ref = refInput.value || "-";
      const total = price * qty;
      const time = new Date().toLocaleString();
      const status = "Unpaid";
      entries.push({ type, price, qty, ref, total, status, time });
      saveData();
      qtyInput.value = 1;
      refInput.value = "";
    }

    function updateStatus(index, newStatus) {
      entries[index].status = newStatus;
      saveData();
    }

    function editEntry(index) {
      const e = entries[index];
      const newQty = prompt("Enter new quantity:", e.qty);
      const newRef = prompt("Enter new Ref:", e.ref);
      if (newQty && !isNaN(newQty)) e.qty = parseInt(newQty);
      if (newRef) e.ref = newRef;
      e.total = e.price * e.qty;
      saveData();
    }

    function resetAll() {
      if (confirm("Clear all records?")) {
        entries = [];
        saveData();
      }
    }

    function exportCSV() {
      let csv = "Type,Price,Qty,Ref,Total,Status,Time\n";
      entries.forEach(e => {
        csv += `${e.type},${e.price},${e.qty},${e.ref},${e.total},${e.status},${e.time}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "pay_parking_data.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importCSV(file) {
      const reader = new FileReader();
      reader.onload = e => {
        const lines = e.target.result.split("\n").slice(1);
        lines.forEach(line => {
          const [type, price, qty, ref, total, status, time] = line.split(",");
          if (!type) return;
          entries.push({
            type,
            price: parseInt(price),
            qty: parseInt(qty),
            ref: ref || "-",
            total: parseInt(total),
            status: status.trim(),
            time: time?.trim() || new Date().toLocaleString()
          });
        });
        saveData();
      };
      reader.readAsText(file);
    }

    addBtn.onclick = addEntry;
    resetBtn.onclick = resetAll;
    exportBtn.onclick = exportCSV;
    importBtn.onclick = () => fileInput.click();
    fileInput.onchange = e => importCSV(e.target.files[0]);
    filterStatus.onchange = renderTable;

    renderTable();
  </script>
</body>
</html>
