<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pay Parking</title>
  <style>
    body {
      background-color: #1a1a1a;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 { color: #00d1ff; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #333;
      color: #00d1ff;
    }
    tr:nth-child(even) {
      background-color: #2a2a2a;
    }
    button {
      background-color: #00d1ff;
      border: none;
      padding: 6px 10px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      margin: 2px;
    }
    button:hover {
      background-color: #0095bb;
    }
    select, input[type="number"], input[type="text"] {
      padding: 5px;
      border-radius: 5px;
      border: none;
      outline: none;
    }
    .controls {
      margin-bottom: 15px;
    }
    .totals {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>Pay Parking</h1>

  <div class="controls">
    <select id="type">
      <option value="Motorcycle">Motorcycle - ₱50</option>
      <option value="Tricycle">Tricycle - ₱75</option>
      <option value="E-bike">E-bike - ₱50</option>
    </select>
    <input type="number" id="qty" min="1" placeholder="Qty" value="1" />
    <input type="text" id="ref" placeholder="Ref / Plate No." />
    <button onclick="addEntry()">Add</button>
    <button onclick="exportCSV()">Export CSV</button>
    <input type="file" id="importFile" accept=".csv" onchange="importCSV(event)" />
    <select id="filterStatus" onchange="filterTable()">
      <option value="All">All</option>
      <option value="Unpaid">Unpaid</option>
      <option value="Paid">Paid</option>
      <option value="Left">Left</option>
    </select>
  </div>

  <table id="logTable">
    <thead>
      <tr>
        <th>Type</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Ref</th>
        <th>Total</th>
        <th>Status</th>
        <th>Time</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="totals">
    <p>Total Amount: ₱<span id="totalAmount">0</span></p>
    <p>Total Paid: ₱<span id="totalPaid">0</span></p>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem("parkingData") || "[]");
    const table = document.querySelector("#logTable tbody");

    function saveData() {
      localStorage.setItem("parkingData", JSON.stringify(data));
      updateTotals();
    }

    function updateTotals() {
      let total = 0, paid = 0;
      data.forEach(r => {
        total += parseFloat(r.total) || 0;
        if (r.status === "Paid" || r.status === "Left") paid += parseFloat(r.total) || 0;
      });
      document.getElementById("totalAmount").innerText = total.toFixed(2);
      document.getElementById("totalPaid").innerText = paid.toFixed(2);
    }

    function renderTable(filtered = "All") {
      table.innerHTML = "";
      data
        .filter(r => filtered === "All" || r.status === filtered)
        .forEach((r, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${r.type}</td>
            <td>₱${r.price}</td>
            <td>${r.qty}</td>
            <td>${r.ref}</td>
            <td>₱${r.total}</td>
            <td>${r.status}</td>
            <td>${r.time}</td>
            <td>
              <button onclick="markPaid(${i})">Mark Paid</button>
              <button onclick="markLeft(${i})">Mark Left</button>
              <button onclick="editEntry(${i})">Edit</button>
              <button onclick="deleteEntry(${i})">Delete</button>
            </td>`;
          table.appendChild(row);
        });
      updateTotals();
    }

    function addEntry() {
      const type = document.getElementById("type").value;
      const qty = parseInt(document.getElementById("qty").value) || 1;
      const ref = document.getElementById("ref").value.trim();
      const price = type === "Tricycle" ? 75 : 50;
      const total = price * qty;
      const time = new Date().toLocaleString();
      data.push({ type, price, qty, ref, total, status: "Unpaid", time });
      saveData();
      renderTable(document.getElementById("filterStatus").value);
    }

    function markPaid(i) {
      data[i].status = data[i].status === "Paid" ? "Unpaid" : "Paid";
      saveData();
      renderTable(document.getElementById("filterStatus").value);
    }

    function markLeft(i) {
      data[i].status = data[i].status === "Left" ? "Unpaid" : "Left";
      saveData();
      renderTable(document.getElementById("filterStatus").value);
    }

    function editEntry(i) {
      const r = data[i];
      const type = prompt("Type:", r.type) || r.type;
      const price = parseFloat(prompt("Price:", r.price)) || r.price;
      const qty = parseInt(prompt("Qty:", r.qty)) || r.qty;
      const ref = prompt("Ref:", r.ref) || r.ref;
      const status = prompt("Status (Unpaid/Paid/Left):", r.status) || r.status;
      const total = price * qty;
      data[i] = { ...r, type, price, qty, ref, status, total };
      saveData();
      renderTable(document.getElementById("filterStatus").value);
    }

    function deleteEntry(i) {
      if (confirm("Delete this entry?")) {
        data.splice(i, 1);
        saveData();
        renderTable(document.getElementById("filterStatus").value);
      }
    }

    function exportCSV() {
      let csv = "type,price,qty,ref,total,status,time\n";
      data.forEach(r => {
        csv += `${r.type},${r.price},${r.qty},${r.ref},${r.total},${r.status},${r.time}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "pay_parking.csv";
      link.click();
    }

    function importCSV(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const lines = e.target.result.trim().split("\n").slice(1);
        lines.forEach(line => {
          const [type, price, qty, ref, total, status, time] = line.split(",");
          data.push({ type, price: parseFloat(price), qty: parseInt(qty), ref, total: parseFloat(total), status, time });
        });
        saveData();
        renderTable(document.getElementById("filterStatus").value);
      };
      reader.readAsText(file);
    }

    function filterTable() {
      const filter = document.getElementById("filterStatus").value;
      renderTable(filter);
    }

    renderTable();
  </script>
</body>
</html>
